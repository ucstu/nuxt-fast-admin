---
title: æ¨¡å—è®¾ç½®
---

# æ¨¡å—è®¾ç½®

æœ¬æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—è®¾ç½®é¡¹ï¼Œè¿™äº›è®¾ç½®é¡¹å¯ä»¥å¯¹æ¨¡å—çš„å„ä¸ªåŠŸèƒ½è¿›è¡Œè°ƒæ•´ã€‚

::alert{type="info"}
ğŸ‰ ç¼–è¾‘ä»¥ä¸‹è®¾ç½®é¡¹å‡æœ‰ä»£ç æç¤ºå’Œæ³¨é‡Šã€‚
::

## å…¨å±€è®¾ç½®

### `nuxt.config.ts`

æœ¬æ¨¡å—åœ¨ `nuxt.config.ts` ä¸­æä¾›äº†ä¸€äº›è®¾ç½®é¡¹ï¼Œä»¥ä¾¿é€‰æ‹©æ€§è°ƒæ•´æ¨¡å—çš„é»˜è®¤è¡Œä¸ºï¼Œå¯ç”¨è®¾ç½®é¡¹å¦‚ä¸‹ï¼š

```ts
export default defineNuxtConfig({
  fastAuth: {
    /**
     * è®¤è¯æä¾›è€…
     * @description å¯é€‰ "local" æ´» "refresh"ï¼Œè¿™ä¸¤çš„åŒºåˆ«åœ¨äºæ˜¯å¦æœ‰ tokenåˆ·æ–° æœºåˆ¶
     * @default "local"
     */
    provider: "refresh",
  },
});
```

### `app.config.ts`

æœ¬æ¨¡å—åœ¨ `app.config.ts` ä¸­æä¾›äº†ä¸€äº›è®¾ç½®é¡¹ï¼Œä»¥ä¾¿é€‰æ‹©æ€§ç¦ç”¨æ¨¡æ¿çš„é»˜è®¤è¡Œä¸ºï¼Œå¯ç”¨è®¾ç½®é¡¹å¦‚ä¸‹ï¼š

````ts
export default defineAppConfig({
  fastAuth: {
    /**
     * è®¤è¯æä¾›è€…é…ç½®
     */
    provider: {
      /**
       * é¡µé¢èšç„¦æ—¶åˆ·æ–°ä»¤ç‰Œ
       * @description å½“çª—å£é‡æ–°è·å¾—ç„¦ç‚¹æ—¶åˆ·æ–°ä»¤ç‰Œ
       * @default true
       */
      refreshOnWindowFocus: true,
      /**
       * åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæ—¶é—´
       * @description åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’
       * @default 256 * 24 * 60 * 60 * 1000
       */
      refreshTokenExpires: 256 * 24 * 60 * 60 * 1000,
      /**
       * é»˜è®¤ä»¤ç‰Œæœ‰æ•ˆæ—¶é—´
       * @description ä»¤ç‰Œæœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’
       * @default 256 * 24 * 60 * 60 * 1000
       */
      tokenExpires: 256 * 24 * 60 * 60 * 1000,
      /**
       * ä»¤ç‰Œåˆ·æ–°æ—¶é—´
       * @description åœ¨ä»¤ç‰Œè¿‡æœŸå‰å¤šä¹…åˆ·æ–°ä»¤ç‰Œï¼Œå•ä½ä¸ºæ¯«ç§’
       * @default 5 * 60 * 1000
       */
      tokenRefresh: 5 * 60 * 1000,
    },
    /**
     * ä¼šè¯ï¼ˆç”¨æˆ·ä¿¡æ¯ï¼‰é…ç½®
     * @description ä¼šè¯é…ç½®
     */
    session: {
      /**
       * å½“çª—å£è·å¾—ç„¦ç‚¹æ—¶åˆ·æ–°ä¼šè¯
       * @default false
       */
      refreshOnWindowFocus: false,
      /**
       * å®šæ—¶åˆ·æ–°ä¼šè¯çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’
       * - `0` è¡¨ç¤ºç¦ç”¨å®šæ—¶åˆ·æ–°
       * - `number` è¡¨ç¤ºå¯ç”¨å®šæ—¶åˆ·æ–°ï¼Œä¸”æŒ‡å®šæ—¶é—´é—´éš”
       * @default 0
       */
      refreshPeriodically: 0,
    },
    /**
     * é¡µé¢é…ç½®
     * @description é¡µé¢é…ç½®
     */
    page: {
      /**
       * é»˜è®¤é¡µé¢é‰´æƒå…ƒæ•°æ®
       * @default
       * ```json
       * {
       *  "auth": false,
       *  "redirect": {
       *   "unAuth": true,
       *   "passed": false,
       *   "failed": true
       *  }
       * }
       * ```
       */
      auth: {
        /**
         * éœ€è¦çš„æƒé™
         * @default false
         */
        auth: false,
        /**
         * é‡å®šå‘é…ç½®
         */
        redirect: {
          /**
           * æœªç™»å½•é‡å®šå‘
           * @description æœªç™»å½•é‡å®šå‘
           * @default true
           */
          anonymous: true,
          /**
           * é‰´æƒé€šè¿‡é‡å®šå‘
           * @description é‰´æƒé€šè¿‡é‡å®šå‘
           * @default false
           */
          passed: false,
          /**
           * é‰´æƒå¤±è´¥é‡å®šå‘
           * @description é‰´æƒå¤±è´¥é‡å®šå‘
           * @default true
           */
          failed: true,
        },
      },
    },
    /**
     * é¦–é¡µè·¯å¾„
     * @description ç™»å½•æˆåŠŸåé‡å®šå‘çš„è·¯å¾„
     * @default "/"
     */
    home: "/",
    /**
     * è®¤è¯é¡µè·¯å¾„
     * @default "/auth"
     */
    signIn: "/auth",
    /**
     * é€€å‡ºç™»å½•é¡µè·¯å¾„
     * @default "/auth"
     */
    signOut: "/auth",
  },
});
````

## å…¨å±€é’©å­

æœ¬æ¨¡å—æä¾›ä¸€äº›é’©å­ï¼Œç”¨äºé…ç½®æ¨¡å—çš„é»˜è®¤è¡Œä¸ºï¼Œå¯ç”¨çš„é’©å­å¦‚ä¸‹ï¼š

```ts
export default defineNuxtPlugin({
  // å¿…é¡»é…ç½®æ­¤é¡¹
  enforce: "pre",
  hooks: {
    /**
     * æ³¨å†Œ
     * @param form æ³¨å†Œè¡¨å•
     */
    "fast-auth:sign-up": (form) => {
      // ä¸€äº›æ³¨å†Œæ“ä½œ
    },
    /**
     * ç™»å½•
     * @param form ç™»å½•è¡¨å•
     * @param result ä»¤ç‰Œ | ç™»å½•ç»“æœ
     */
    "fast-auth:sign-in": (form, result) => {
      // ä¸€äº›ç™»å½•æ“ä½œ
      // è®¾ç½® token
      result.value = "token-admin";
    },
    /**
     * æ³¨é”€
     */
    "fast-auth:sign-out": (user, token) => {
      // ä¸€äº›æ¸…ç†æ“ä½œï¼Œuser å’Œ token è‡ªåŠ¨æ¸…ç†ï¼ˆæ— éœ€æ‰‹åŠ¨æ¸…ç†ï¼‰
    },
    /**
     * è·å–ç”¨æˆ·
     * @param token ä»¤ç‰Œ
     * @param result ç”¨æˆ·ä¿¡æ¯
     */
    "fast-auth:get-user": (token, result) => {
      // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
      result.value = {};
    },
    /**
     * è·å–è§’è‰²åˆ—è¡¨
     * @description å³ä»ç”¨æˆ·ä¿¡æ¯ä¸­è·å–è§’è‰²åˆ—è¡¨
     * @param user ç”¨æˆ·ä¿¡æ¯
     * @param result è§’è‰²åˆ—è¡¨
     */
    "fast-auth:get-roles": (user, result) => {
      // è®¾ç½®è§’è‰²åˆ—è¡¨
      result.value = [];
    },
    /**
     * è·å–æƒé™åˆ—è¡¨
     * @description å³ä»ç”¨æˆ·ä¿¡æ¯ä¸­è·å–æƒé™åˆ—è¡¨
     * @param user ç”¨æˆ·ä¿¡æ¯
     * @param role è§’è‰²ä¿¡æ¯
     * @param result æƒé™åˆ—è¡¨
     */
    "fast-auth:get-permissions": (user, role, result) => {
      result.value = [];
    },
    /**
     * åˆ·æ–°ä»¤ç‰Œ
     * @param token ä»¤ç‰Œ
     * @param refreshToken åˆ·æ–°ä»¤ç‰Œ
     * @param result åˆ·æ–°ç»“æœ
     */
    "fast-auth:refresh-token": (token, refreshToken, result) => {
      // è®¾ç½®æ–°çš„ token
      result.value = "new-token";
    },
    /**
     * å‰ç½®è®¤è¯é’©å­
     * @param options é€‰é¡¹
     * @param result è·³è½¬ | null
     * @description è¿”å›å€¼ä¸º null æ—¶ç»§ç»­è·¯ç”±å®ˆå«
     * @description è¿”å›å€¼ä¸º undefined æ—¶ç»ˆæ­¢è·¯ç”±å®ˆå«
     * @description æ³¨æ„ï¼šä¸å†™è¿”å›å€¼æ—¶é»˜è®¤è¿”å› undefined
     */
    "fast-auth:before-auth": (options, result) => {},
    /**
     * æ— éœ€è®¤è¯
     * @param options é€‰é¡¹
     * @param result è·³è½¬ | null
     * @description è¿”å›å€¼ä¸º null æ—¶ç»§ç»­è·¯ç”±å®ˆå«
     * @description è¿”å›å€¼ä¸º undefined æ—¶ç»ˆæ­¢è·¯ç”±å®ˆå«
     * @description æ³¨æ„ï¼šä¸å†™è¿”å›å€¼æ—¶é»˜è®¤è¿”å› undefined
     */
    "fast-auth:auth-through": (options, result) => {},
    /**
     * éœ€è¦è®¤è¯ä½†æœªç™»å½•
     * @param options é€‰é¡¹
     * @param result è·³è½¬ | null
     * @description è¿”å›å€¼ä¸º null æ—¶ç»§ç»­è·¯ç”±å®ˆå«
     * @description è¿”å›å€¼ä¸º undefined æ—¶ç»ˆæ­¢è·¯ç”±å®ˆå«
     * @description æ³¨æ„ï¼šä¸å†™è¿”å›å€¼æ—¶é»˜è®¤è¿”å› undefined
     */
    "fast-auth:auth-anonymous": (options, result) => {},
    /**
     * éœ€è¦é‰´æƒä¸”å·²é€šè¿‡
     * @param options é€‰é¡¹
     * @param result è·³è½¬ | null
     * @description è¿”å›å€¼ä¸º null æ—¶ç»§ç»­è·¯ç”±å®ˆå«
     * @description è¿”å›å€¼ä¸º undefined æ—¶ç»ˆæ­¢è·¯ç”±å®ˆå«
     * @description æ³¨æ„ï¼šä¸å†™è¿”å›å€¼æ—¶é»˜è®¤è¿”å› undefined
     */
    "fast-auth:auth-passed": (options, result) => {},
    /**
     * éœ€è¦é‰´æƒä½†æœªé€šè¿‡
     * @param options é€‰é¡¹
     * @param result è·³è½¬ | null
     * @description è¿”å›å€¼ä¸º null æ—¶ç»§ç»­è·¯ç”±å®ˆå«
     * @description è¿”å›å€¼ä¸º undefined æ—¶ç»ˆæ­¢è·¯ç”±å®ˆå«
     * @description æ³¨æ„ï¼šä¸å†™è¿”å›å€¼æ—¶é»˜è®¤è¿”å› undefined
     */
    "fast-auth:auth-failed": (options, result) => {},
    /**
     * åç½®è®¤è¯é’©å­
     * @param options é€‰é¡¹
     * @param result è·³è½¬ | null
     * @description è¿”å›å€¼ä¸º null æ—¶ç»§ç»­è·¯ç”±å®ˆå«
     * @description è¿”å›å€¼ä¸º undefined æ—¶ç»ˆæ­¢è·¯ç”±å®ˆå«
     * @description æ³¨æ„ï¼šä¸å†™è¿”å›å€¼æ—¶é»˜è®¤è¿”å› undefined
     */
    "fast-auth:after-auth": (options, result) => {},
  },
});
```

## é¡µé¢è®¾ç½®

### `definePageMeta`

æœ¬æ¨¡å—æ‰©å±•äº† `nuxt` çš„ `definePageMeta` å‚æ•°ï¼Œé’ˆå¯¹é¡µé¢è°ƒæ•´æ¨¡å—è¡Œä¸ºå¯åœ¨è¿™é‡Œè¿›è¡Œä¿®æ”¹ã€‚

```ts
definePageMeta({
  auth: {
    /**
     * éœ€è¦çš„æƒé™
     * @default false
     */
    auth: [
      "|",
      {
        type: "role",
        value: "admin",
      },
      {
        type: "per",
        value: "users:view",
      },
      // per çš„ç®€å†™
      "users:add",
    ],
    /**
     * é‡å®šå‘é…ç½®
     */
    redirect: {
      /**
       * æœªç™»å½•é‡å®šå‘
       * @description æœªç™»å½•é‡å®šå‘
       * @default true
       */
      anonymous: "/auth",
      /**
       * é‰´æƒé€šè¿‡é‡å®šå‘
       * @description é‰´æƒé€šè¿‡é‡å®šå‘
       * @default false
       */
      passed: "/admin",
      /**
       * é‰´æƒå¤±è´¥é‡å®šå‘
       * @description é‰´æƒå¤±è´¥é‡å®šå‘
       * @default true
       */
      failed: "/auth",
    },
  },
});
```
